% $Author: oscar$
% $Translate: mathieu chappuis + martial boniou $
% $Date: 2007-12-13 15:59:51 +0100 (Thu, 13 Dec 2007) $
% $Revision$
% $french: Sat Dec 15 21:51:14 CET 2007$ 
%%%%%%%%%%%%%%%%%%%%%%
% note temporaire de Martial destine aux relectures:
% collapse a window --> ranger la fenetre (et pas reduire, si vous
% voyez cette erreur, SVP merci de corriger)
%%%%%%%%%%%%%%%%%%%%%%
%=================================================================
\ifx\wholebook\relax\else
% --------------------------------------------
% Lulu:
	\documentclass[a4paper,10pt,twoside]{book}
	\usepackage[
		papersize={6in,9in},
		hmargin={.75in,.75in},
		vmargin={.75in,1in},
		ignoreheadfoot
	]{geometry}
	\input{../common.tex}
	\pagestyle{headings}
	\setboolean{lulu}{true}
% --------------------------------------------
% A4:
%	\documentclass[a4paper,11pt,twoside]{book}
%	\input{../common.tex}
%	\usepackage{a4wide}
% --------------------------------------------
    \graphicspath{{figures/} {../figures/}}
	\begin{document}
	\renewcommand{\nnbb}[2]{} % Disable editorial comments
	\sloppy
\fi
%=================================================================
\newcommand{\clover}{%
	\raisebox{-0.8ex}[0pt][0pt]{%
		\includegraphics[width=1em]{cloverleafKey}}}
%=================================================================
\chapter{Une visite de \sq}
\label{cha:quick}

%In this chapter we will give you a high-level tour of \sq to help you get comfortable with the environment.
%There will be plenty of opportunities to try things out, so it would be a good idea if you have a computer handy when you read this chapter.

Nous vous proposons dans ce chapitre une premi\`ere visite de \sq afin de vous familiariser avec son environnement.
De nombreux aspects seront abordés; il est conseillé d'avoir une
machine pr\^ete \`a l'emploi pour suivre ce chapitre. 


%We will use this icon: \dothisicon{} to mark places in the text where you should try something out in \sq.
%In particular, you will fire up \sq, learn about the different ways of interacting with the system, and discover some of the basic tools.
%You will also learn how to define a new method, create an object and send it messages.

Cet icône \dothisicon{} dans le texte signalera les étapes où vous devrez essayer quelque chose vous-même.
Vous apprendez à démarrer \sq et les différentes manières d'utiliser l'environnement et les outils de base.
La création des méthodes, des objets et les envois de messages seront également abordés.

%=================================================================
\section{Premiers pas}

%\sq is available as a free \ind{download} from \url{www.squeak.org}.
%There are three parts that you will need to download, consisting of four files (see \figref{download}).

\sq est librement disponible depuis le site principal de \sq: \url{www.squeak.org}.
Vous devez y télécharger 3 archives (pour 4 fichiers principaux qui
constituent une installation courante de \sq; voir \figref{download}) 

\begin{figure}[htb]
\centerline {\includegraphics[width=\textwidth]{annotatedDownload}}
\caption{Téléchargement de \sq. \label{fig:download}}
\end{figure}

\begin{enumerate}

  %\item The \emphind{virtual machine} (VM) is the only part of the system that is different for each operating system and processor.  Pre-compiled virtual machines are available for all the major computing environments.  In \figref{download} we see the VM for the Mac is called \textit{\sq 3.8.15beta1U.app}.

\item La \emphind{machine virtuelle} (agr\'eg\'e en VM pour
  \emph{virtual machine}) est la seule partie de l'environnement qui
  est particulière à chaque système d'exploitation. Des machines
  virtuelles pré-compilées sont disponibles pour la plupart des
  systèmes (Linux, OS/X, Win32). Dans \figref{download}, vous
  remarquerez par exemple la machine virtuelle pour le syst\`eme MacOSX: \textit{\sq 3.8.15beta1U.app}.
%martial: ajout des index dans la vf
\index{machine virtuelle}
\seeindex{VM}{machine virtuelle}

%  \item The \emphind{sources} file contains the source code for all of the parts of \sq that don't change very frequently. In \figref{download} it is called \emph{SqueakV39.sources}. Note that the file SqueakV39.sources is only for versions 3.9 and later of \sq. For earlier versions, use a sources file corresponding to the main version \eg \textit{SqueakV3.sources} for versions of \sq from 3.0 up to 3.8.

  \item Le fichier \emphind{source} contient le code source du système
    \sq qui ne change pas tr\`es souvent. Dans \figref{download}, il
    correspond au fichier \emph{SqueakV39.sources}. Le fichier-source SqueakV39.sources n'est destiné qu'aux versions 3.9 ou supérieures de \sq. Pour des versions antérieures vous devez utiliser un fichier-source (par exemple SqueakV3.sources) de même version que \sq (de 3.0 à 3.8). 
%ajout fr index
\index{fichier!source}
\seeindex{fichier-source}{fichier, source}
\seeindex{SqueakV39.sources}{fichier, source}
\seeindex{SqueakV3.sources}{fichier, source}

%  \item The current \emph{system \ind{image}} is a snapshot of a running \sq system, frozen in time.  It consists of two files: an \emph{.}\emphind{image} file, which contains the state of all of the objects in the system (including classes and methods, since they are objects too), and a \emph{.}\emphind{changes} file, which contains a log of all of the changes to the source code of the system.

\item Le fichier \emph{\ind{image}} est un cliché d'un système en fonctionnement, figé à un instant donné. 
Il est composé de deux fichiers: le premier nommé avec l'extension
\emph{.}\emphind{image} contient l'état de tous les objets du système
ainsi que les classes et les méthodes puisque ce sont aussi des
objets. Le second avec l'extension \emph{.}\emphind{changes} contient
toutes les modifications apportées au code source; elles y sont journalisées.
%ajout fr index
\index{fichier!image}
\index{fichier!changes}

%In \figref{download}, we see that we have grabbed the \textit{Squeak3.9-final-7067} image and sources files.
\end{enumerate}

\dothis{Téléchargez et installez \sq sur votre ordinateur.}
\index{t\'el\'echargement}

%The version of \sq that we have used for developing the examples in this book is \emphind{Squeak-dev}, available from \url{http://damien.cassou.free.fr/squeak-dev}.
%\label{sec:squeakDev}

Dans ce livre, nous avons utilisé pour d\'evelopper tous les exemples
la version \emphind{Squeak-dev} de \sq; cette image est disponible sur
\squeakdev. 
%\url{http://damien.cassou.free.fr/squeak-dev}.
\label{sec:squeakDev}
%We chose this image because it has a wider variety of programming tools pre-installed, and because additional packages can be loaded with a single click.  
Elle contient une large collection d'outils de développement et permet d'installer très facilement des paquetages complémentaires.
%Most of the introductory material in this book will work with any version, so if you already have one installed, you may as well continue to use it.  
Si vous avez déjà une autre version de \sq qui fonctionne sur votre
machine, la plupart des exemples d'introduction de ce livre
fonctionneront. Il n'est donc pas nécessaire de mettre à jour \sq.
%However, if you notice differences between the appearance or behavior of your system and what is described here, do not be surprised. 
D\`es lors, ne soyez pas surpris de constater parfois des différences dans l'apparence ou le comportement que nous décrirons.
%On the other hand, if you are about to download \sq for the first time, you may as well grab the \emph{Squeak-dev} image.
D'un autre c\^ot\'e, si vous téléchargez \sq pour la première fois,
vous devriez rapatrier et utiliser l'image \emph{Squeak-dev}.

%As you work in \sq, the image and changes files are modified, so you need to make sure that they are writable.
Pendant que vous travaillez avec \sq les fichiers \emph{.image} et \emph{.changes} sont modifiés, vous devez vous assurer qu'ils sont accessibles en écriture.
Conservez toujours ces deux fichiers ensemble, \cad dans le même dossier.
Et surtout, ne tentez pas de les modifier avec un éditeur de texte, \sq les utilise pour stocker vos objets de travail et vos changements dans le code source.
Faire une copie de sauvegarde de vos images téléchargées et de vos
fichiers \emph{changes} est une bonne id\'ee; vous pourrez ainsi
toujours démarrer à partir d'une image propre et y recharger votre code.

Les fichiers \emphind{sources} et l'exécutable de la VM peuvent être
en lecture seule\,---\,il est donc possible de les partager entre plusieurs utilisateurs.
Ces quatre fichiers peuvent résider dans le même dossier, mais vous pouvez également placer la machine virtuelle et les fichiers sources dans un dossier partagé distinct.
Vous pouvez adapter l'installation de \sq à vos habitudes de travail
et \`a votre système d'exploitation.

\sd{it would be really nice to have a setup and startup section on PC, Mac and Linux}
\ab{I agree entirely; the reason that this is not here is because I could do only the Mac section.  Damien can probably do Windoze.  Perhaps we can ask on the list for a Linux volunteer?}

% %-----------------------------------------------------------------
\begin{figure}[htb]
% %\centerline {\includegraphics[width=0.6\textwidth]{download}}
\centerline {\includegraphics[width=0.95\textwidth]{startup}}
\caption{Une image \sq fra\^{\i}chement d\'emarr\'ee.\label{fig:startup}}
\end{figure}

\index{Lancer Squeak}

\paragraph{Lancement.} Pour lancer \sq, selon votre système: glissez
le fichier \emph{.}\emphind{image} sur l'icône de l'exécutable de la
machine virtuelle, ou double-cliquez sur le fichier
\emph{.}\emphind{image}, ou encore, depuis une ligne de commande,
tapez le nom du fichier binaire correspondant \`a la machine virtuelle
suivi du le chemin d'accès au fichier \emph{.}\emphind{image} (si vous
avez installé plusieurs machines virtuelles, le système ne choisira
pas forcément celle qui convient, il sera préférable de
glisser-déposer l'image sur la VM ou d'utiliser la ligne de commande).

Une fois lancé, \sq vous présente une large fenêtre qui contient des espaces de travail (voir \figref{startup}). Notez qu'il n'y a pas de barre de menu, à la place \sq utilise des menus contextuels. 

%martial: j'ai mis 'normalement les reduit' parce que si la barre des
%taches est chargee, la fenetre est minimisee a la OS/2
\dothis{Lancez \sq. Vous pouvez fermer les fen\^etres d\'ej\`a
  ouvertes en cliquant sur l'icône {\sf X} situ\'e sur le coin
  supérieur gauche des fenêtres ou les ranger (ce qui normalement les
  r\'eduit \`a  leur barre de titre) en cliquant sur le symbole \raisebox{-0.2ex}{{\Large $\circ$}} au coin supérieur droit.}

%-----------------------------------------------------------------
\paragraph{Première interaction.}

Les options du menu World (``Monde'' en anglais) pr\'esent\'e dans
\figref{threeButtons:red} sont un bon point de d\'epart.

\dothis{Cliquez à l'aide de la souris dans l'arrière plan de la
  fenêtre principale pour afficher le menu World, puis sélectionnez
  \menu{open \ldots \go workspace} pour créer un nouvel espace de
  travail ou Workspace.}


\begin{figure}[tbh]
	\centering
	\subfigure[Le menu World]{\label{fig:threeButtons:red}%
		\includegraphics[width=0.2\linewidth]{worldMenu}}\hfill
	\subfigure[le menu contextuel]{\label{fig:threeButtons:yellow}%
		\includegraphics[width=0.25\linewidth]{yellowButtonMenuOnWorkspace}}\hfill
	\subfigure[Le halo]{\label{fig:threeButtons:blue}%FIXFR
		\includegraphics[width=0.25\linewidth]{morphicHaloOnWorkspace}}% these braces needed (else no whitespace at end of line)
	\caption{Le menu World (affiché avec le bouton rouge de la
      souris), un menu contextuel (bouton jaune de la souris) et un
      \subind{Morphic}{halo} Morphic (bouton bleu de la souris).\label{fig:threeButtons}}
\end{figure}
\index{bouton rouge}
\index{bouton jaune}
\index{bouton bleu}
%\seeindex{morphic halo}{Morphic}
\seeindex{halo}{Morphic}

% ON: I had to shrink this and move it up to avoid
% it running over the end of the page.
% position d'origine de la figure colouredMouse


\sq a été conçu à l'origine pour être utilisé avec une souris à trois
boutons. Si votre souris en a moins, vous pourrez utiliser des touches
du clavier en complément de la souris pour simuler les boutons
manquants. Une souris à deux boutons fonctionne bien avec \sq, mais si
la v\^otre n'a qu'un seul bouton vous devriez songer à adopter un
modèle récent avec une molette qui fera office de troisième bouton: votre travail avec \sq n'en sera que plus agréable.


\sq évite les termes ``clic gauche'' ou ``clic droit'' car leurs
effets peuvent varier selon les systèmes, le mat\'eriel ou les
réglages utilisateur. \sq désigne les boutons avec des couleurs. Le
bouton avec lequel vous obtenez le menu World est intitulé le
\emphind{bouton rouge}; il est employé le plus souvent pour
s\'electionner du texte, des \'el\'ements de listes ou des choix de
menus et pour déplacer des fenêtres.

%martial: j'ai mis 14 au lieu de 19 
\begin{wrapfigure}[14]{r}{0.25\linewidth}
% The parameters are the number of narrow lines to the right of the figure [19],
% the placement {r} for right, and the width of the figure. Capital R will allow some float.
% Inside the wrapfig environment, linewidth is special --- the width of the figure.
\includegraphics[width=0.95\linewidth]{colouredMouse}
\caption{La souris de l'auteur. Le clic avec la molette correspond au bouton bleu.\label{fig:colouredMouse}}
\end{wrapfigure}
 
Lors de vos premiers pas avec \sq, il vous sera sûrement utile de
marquer votre souris des couleurs, comme vous pouvez le voir sur \figref{colouredMouse}.

Le \emphind{bouton jaune} est l'autre bouton le plus employé dans \sq, vous l'utiliserez pour afficher les menus contextuels qui présentent des options selon le contexte ou plus précisement selon l'endroit et les objets sur lesquels vous cliquez. Voyez \figref{threeButtons:yellow}.


\dothis{Saisissez \ct{Time now}
%ajout 
(expression retournant le temps pr\'esent) dans le Workspace.
Puis cliquez avec le bouton jaune dans le Workspace et sélectionnez
\menu{print it} 
%ajout
(en fran\c{c}ais, ``affichez-le'')
dans le menu qui apparaît.}

Enfin, le \emphind{bouton bleu} est utilisé pour activer le
``\subind{Morphic}{halo}'', une constellation d'ic\^ones autour de l'objet
actif de l'écran; chaque ic\^one repr\'esentant une poign\'ee de contr\^ole
permettant des actions telles que \emph{changer la taille} ou
\emph{faire pivoter l'objet}, comme le montre \figref{threeButtons:blue}.
En survolant lentement les poignées avec le pointeur de votre souris,
une bulle d'aide en affichera un descriptif
%ajout
(en anglais, dans la version d'origine de \sq).

\dothis{Cliquez avec le bouton bleu sur le Workspace.
Déplacez la poignée \raisebox{-0.4ex}{\includegraphics[width=1em]{morphicRotate}} située à proximité du coin inférieur gauche pour faire pivoter le Workspace.}

Nous recommandons aux personnes gauchères de configurer leur souris et d'affecter le \ind{button rouge} à la gauche de leur souris, le \ind{bouton jaune} à droite et d'utiliser la molette de défilement (si elle est disponible) comme \ind{bouton bleu}.
Avec une souris sans molette il est possible d'invoquer le menu halo
en maintenant \ct{alt}, \ct{ctrl}
ou \ct{option} pendant que vous cliquez sur le \ind{bouton rouge}.
Si vous utilisez un Macintosh avec une souris à un bouton, vous pouvez
simuler le second bouton en maintenant la touche \clover{} enfoncée et
en cliquant. Cependant, si vous prévoyez d'utiliser \sq souvent, nous
vous recommandons d'investir dans un modèle à deux boutons au minimum.

%  j'ai ajouté CTRL car sur mon linux ni alt ni fn.. ne marchent pour
%  ça. seul ctrl le fait..
% note de martial: ca depend aussi du windowmanager; c'est une bonne
% idee de le mettre en tout cas 
Vous pouvez configurer votre souris selon vos souhaits en utilisant les préférences de votre système ou le pilote de votre dispostif de pointage.
\sq vous propose des réglages pour adapter votre souris et les touches spéciales de votre clavier. Vous trouverez le \ind{Preference Browser} dans l'option \menu{open...} du menu \menu{World}.
Dans l'outil de r\'eglage des pr\'ef\'erences nomm\'e Preference
Browser, la catégorie \menu{general} contient une option
\menu{swapMouseButtons} qui permute les boutons jaune et bleu (voir
\figref{prefBrowser}). La cat\'egorie \menu{keyboard} (clavier)
propose des options afin de dupliquer les touches de commandes et 
rendre une pression sur \ct{alt} \'equivalente à une pression sur \ct{ctrl}.

\dothis{Ouvrez le Preference Browser en cliquant avec le bouton rouge dans l'arrière-plan de la fenêtre de \sq et cherchez l'option \menu{swapMouseButtons} en utilisant la zone de recherche.}

\begin{figure}[htb]
\ifluluelse
	{\centerline {\includegraphics[width=\textwidth]{PreferenceBrowser}}}
	{\centerline {\includegraphics[scale=0.7]{PreferenceBrowser}}}
\caption{Le Preference Browser.\label{fig:prefBrowser}}
\end{figure}

%=================================================================
\section{Le menu World}
\index{menu World}

\dothis{Cliquez avec le bouton rouge dans l'arrière plan de \sq.}
Le menu \menu{World} apparaît à nouveau.
La plupart des menus de \sq ne sont pas modaux, tout comme, par
%ajout par mathieu; correct
exemple, une fenêtre de dialogue pour la sauvegarde d'un fichier que
vous devez soit compléter, soit annuler, sans pouvoir travailler en même temps dans l'application. 
Avec \sq vous pouvez maintenir ces menus sur l'écran en cliquant sur
l'icône en forme d'épingle au coin supérieur droit. Essayez! Vous
remarquerez que les menus apparaissent  quand  vous cliquez  mais ne
disparaissent pas quand vous relâchez votre bouton, ils restent
visibles jusqu'à que vous ayez fait une sélection ou que vous ayez
cliqué en dehors du menu. Tous les menus affichés à l'écran peuvent se déplacer en glissant leur barre de titre, comme n'importe quelle fenêtre.

Le menu World vous offre un moyen simple d'accéder à la plupart des
outils disponibles dans \sq.

\dothis{Regardez attentivement le menu \menu{world\go{}open\ldots}.}
Vous verrez  les principaux outils de \sq dont le System Browser (l'un
des nombreux navigateurs de classes) et l'espace de travail
Workspace. Nous aurons affaire à eux dans les prochains chapitres.

\begin{figure}[htb]
\ifluluelse
	%{\centerline {\includegraphics[width=0.3\textwidth]{OpenMenu}}}
	{\centerline {\includegraphics[scale=0.5]{OpenMenu}}}
	{\centerline {\includegraphics[scale=0.7]{OpenMenu}}}
\caption{L'option \menu{open\ldots} dans le menu World.\label{fig:openmenu}}
\end{figure}

%=================================================================
\section{Enregistrer, quitter et redémarrer une session \sq.}

\dothis{Affichez le menu World, puis sélectionnez \menu{new
    morph\ldots} et défilez 
%ajout
dans le nouveau menu flottant ``Add a new morph'' (ajouter un nouveau morph)
jusqu'à \menu{from alphabetical list{\go}A-C{\go}BlobMorph}. Vous avez
maintenant un \blobmorph ``dans la main''. Positionnez-le où vous le
souhaitez (en cliquant avec le bouton rouge). Votre forme Morphic s'animera.}
%\index{Formes}
\index{Morphic}

\begin{figure}[htb]
\begin{minipage}[b]{0.48\textwidth}
\ifluluelse
	{\centerline{\includegraphics[scale=0.5]{Blob}}}
	{\centerline{\includegraphics[scale=0.7]{Blob}}}
	\caption{Une instance d'un \lct{BlobMorph}.\label{fig:blob}}
\end{minipage}
\hfill
\begin{minipage}[b]{0.48\textwidth}
\ifluluelse
	{\centerline {\includegraphics[scale=0.5]{saveAs}}}
	{\centerline {\includegraphics[scale=0.7]{saveAs}}}
	\caption{La bo\^{\i}te de dialogue \menu{save as\ldots}.\label{fig:saveas}}
\end{minipage}
\end{figure}

\dothis{Sélectionnez \menu{World\go{}save as\ldots} et entrez le nom
  ``SBE'', puis cliquez sur le bouton \menu{Accept(s)} 
%ajout
pour sauvegarder sous un nouveau nom d'image. 
Pour quitter, sélectionnez \menu{World\go{}save and quit}.}

Le dossier qui contenait les fichiers image et \emph{changes} lorsque
vous avez lancé cette session de travail avec \sq contient d\'esormais
deux nouveaux fichiers: ``SBE.\ind{image}'' et ``SBE.\ind{changes}''. 
%image vivante = working state of the squeak image
Ils repr\'esentent l'image ``vivante'' de votre session \sq au moment qui précédait votre enregistrement avec \menu{save and quit}.
Ces deux fichiers peuvent être copiés à votre convenance dans les
dossiers  de votre disque pour y être utilisés plus tard. \`A vous de
les invoquer en prenant soin (selon votre syst\`eme de fichiers) de
%note de martial: j'ai transforme pour plus de logique mais c'est
%lourd: a revoir
d\'eplacer, copier ou lier le fichier \emph{.source} correspondant,
tout en veillant \`a ex\'ecuter la bonne machine virtuelle.

\dothis{Lancez \sq avec l'image que vous venez de créer \cad le
  fichier ``SBE.image''.}

Vous retrouvez l'état de votre session exactement tel qu'il était
avant que vous quittiez \sq. Le \blobmorph est toujours sur votre
fenêtre de travail, en train de se déplacer d'o\`u vous l'aviez abandonné.

En lançant pour la première fois \sq, la \ind{machine virtuelle}
charge le fichier image que vous spécifiez. Ce fichier contient
l'instantané d'un grand nombre d'objets et surtout le code
pré-existant accompagné des outils de développement qui sont
d'ailleurs des objets comme les autres. En travaillant dans \sq, vous
allez envoyer des messages à ces objets, en créer de nouveaux, et
certains seront supprimés et l'espace-mémoire utilisé sera récupéré
(\ie pass\'e au ramasse-miettes ou \emph{garbage collector}).

En quittant \sq vous sauvegardez un instantané de tous vos objets. En sauvegardant (par ``save''), vous remplacerez l'image courante par l'instantané de votre session. Pour préserver l'image courante, vous devez enregister sous un nouveau nom comme nous venons de le faire.

Chaque fichier \emph{.image} est accompagné d'un fichier \emph{.changes}.
Ce fichier contient un journal de toutes les modifications que vous avez faites en utilisant l'environnement de développement.
Vous n'avez pas à vous soucier de ce fichier la plupart du temps.
Mais comme nous allons le voir plus tard, le fichier \emph{.changes} pourra être utilisé pour rétablir votre système \sq à la suite d'erreurs.

L'image sur laquelle vous travaillez provient d'une image de \st-80 créée à la fin des années 1970.
Beaucoup des objets qu'elle contient sont là depuis des décennies!

Vous pourriez penser que l'utilisation d'une image est incontournable pour stocker et gérer des projets, mais comme nous le verrons bientôt il existe des outils plus adaptés pour gérer le code et travailler en équipe sur des projets.
Les images sont très utiles mais on considère comme une pratique plutôt brusque de les employer pour diffuser et partager vos projets alors qu'il existe des outils tels que Monticello qui proposent de biens meilleurs moyens de suivre les évolutions du code et de le partager entre plusieurs développeurs.

\dothis{Cliquez avec le bouton bleu sur le \blobmorph}

%martial: le choix des noms 'poignee' 'icone' ... pourra etre change
Vous verrez tout autour une collection d'icônes colorées nomm\'ee
\subind{Morphic}{halo}; l'\emphsubind{halo}{ic\^one}
\subind{Morphic}{halo} est aussi appel\'ee \emphsubind{halo}{poignée}.
Cliquez sur la poignée rose p\^ale qui contient une croix; le
\blobmorph disparaît (pour réussir cette manipulation, vous pourriez
peut-être avoir besoin de faire plusieurs tentatives car le \blobmorph
se déplace et peut fuir votre souris et vous empêcher de cliquer à
l'endroit attendu).
%(index Morphic vs halo) a revoir?
\seeindex{poign\'ee}{halo, poign\'ee}
\seeindex{Morphic!poign\'ee}{halo, poign\'ee}
\seeindex{ic\^one}{halo, ic\^one}
\seeindex{Morphic!ic\^one}{halo, ic\^one}
\seeindex{halo}{Morphic, halo}

\begin{figure}[htb]
\ifluluelse
	{\centerline {\includegraphics[width=\textwidth]{Tools}}}
	{\centerline {\includegraphics[width=0.8\textwidth]{Tools}}}
\caption{\Toolsflap dans \sq.\label{fig:tools}}
\end{figure}

%=================================================================
\section{Les fenêtres Workspace et Transcript}
\label{sec:transcript}

\dothis{Fermez toutes fenêtres actuellement ouvertes. Cliquez sur
  l'onglet \menu{Tools} à la droite de la fenêtre principale de \sq
  pour ouvrir le volet des outils (Tools Flap).}
L'onglet s'élargira et présentera les icônes de certains outils importants de \sq (\figref{tools}). Glissez alors l'icône \ind{Transcript} puis l'icône \ind{Workspace}.

\dothis{Positionnez et redimensionnez le Transcript et le Workspace
  pour que ce dernier recouvre le Transcript.}
Vous pouvez redimensionner les fenêtres en glissant l'un de leurs
coins ou en cliquant avec le bouton bleu qui affiche les poignées
\emph{halo}: utilisez alors l'icône jaune situé en bas à droite.

Une seule fenêtre est active à la fois; elle s'affiche au premier plan
et son titre est alors mis en relief. Notez que le pointeur de la
souris doit être dans la fenêtre dans laquelle vous souhaitez saisir du texte.

Le Transcript est un objet qui est couramment utilisé pour afficher
des messages du système. C'est un genre de ``console''.
Sachez que l'affichage dans la fenêtre Transcript est extr\^ement
lent, donc si vous la conservez ouverte et que vous y affichez des
résultats, certaines opérations peuvent \^etre 10 fois plus lentes.
De plus, le Transcript n'est pas conçu pour recevoir
simultanément des messages à afficher provenant de plusieurs objets:
il n'est pas prot\'eg\'e contre les acc\`es concourrants (en anglais,
\emph{thread-safe}), donc vous pourriez \^etre t\'emoin de
comportements \'etranges si plusieurs objets tentent d'\'ecrire de
mani\`ere concourrante dans le Transcript. 

%%%% martial: Sat Dec 15 14:13:47 CET 2007
Les fen\^etres de Workspace ou espace de travail sont destin\'ees \`a
y saisir vos expressions de code \st \`a exp\'erimenter.
Vous pouvez aussi les utiliser simplement pour taper une quelconque
note de texte \`a retenir, comme une liste de choses \`a faire (en
anglais, \emph{todo-list}) ou des instructions pour quiconque est
amen\'e \`a utiliser votre image.
Les Workspaces sont souvent employ\'es pour maintenir une
documentation \`a propos de l'image captur\'ee, comme c'est le cas
dans l'image standard pr\'ec\'edemment charg\'ee (voir
\figref{startup}).

% originellement 'hello world'
\dothis{Saisissez le texte suivant dans l'espace de travail Workspace:}
\begin{code}{}
Transcript show: 'bonjour squeak'; cr.
\end{code}

%ajout
Exp\'erimentez la s\'election
en double-cliquant dans l'espace de travail \`a diff\'erents points dans
le texte que vous venez de saisir.
% entire word, entire string, or the whole text ((diff: string and word?))
Remarquez comment un mot entier ou une tout un texte est
s\'electionn\'e selon l'endroit o\`u vous cliquez.

\dothis{S\'electionnez le texte que vous avez saisi puis cliquez \`a
  l'aide du bouton jaune.
Choisissez \menu{do it (d)} 
%ajout
(dans le sens ``faites-le!'', \cad \emph{\'evaluer le code
  s\'electionn\'e})
dans le menu contextuel.}
Notez l'apparition du texte ``bonjour squeak'' appara\^{\i}t dans la
fen\^etre Transcript (voir \figref{doit}).
Refaites encore un \menu{do it (d)}
(Le \menu{(d)} dans l'option de menu \menu{do it (d)} vous indique que
le raccourci-clavier correspondant est \short{d}. Pour plus
d'informations, rendez-vous dans la prochaine section!).

% Doit en version francisee: 'bonjour squeak' plutot que 'hello world'
% attention: l'image figures/HelloWorld.png est obsolete 
\begin{figure}[htb]
\ifluluelse
	{\centerline {\includegraphics[width=\textwidth]{Doit}}}
	{\centerline {\includegraphics[scale=0.7]{Doit}}}
\caption{Ex\'ecuter une expression.\label{fig:doit}}
\end{figure}

Vous venez d'\'evaluer votre premi\`ere~\footnote{NdT: les anglosaxons
auraient remplac\'e le ``bonjour squeak'' par ``hello world'' qui a le
sens de ``salut le monde'' dans la plus pur tradition de la
programmation; celle-ci veut que le premier programme
dans un nouveau langage consiste \`a afficher la phrase ``hello
world''.}
expression \st!
Vous avez seulement envoyer le message \ct{show: 'bonjour squeak'} \`a
l'objet \ct{Transcript} (\ct{show:} veut dire: afficher), suivi du
message \ct{cr} 
%ajout
(qui a le sens de \emph{carriage return}, \cad retour-chariot
permettant de forcer le passage \`a la ligne suivante).
Le \ct{Transcript} d\'ecide ensuite de quoi faire avec ce message; il
cherche parmi ses \emph{m\'ethodes} celles qui g\`ere une r\'eponse
aux messages \ct{show:} et \ct{cr} et qui r\'eagissent de fa\c{c}on
appropri\'ee.

Si vous discutez un peu avec un Smalltalkien, vous remarquerez
rapidement qu'il n'emploie g\'en\'eralement pas des expressions
telles que ``appeler un op\'erateur'' ou ``invoquer une m\'ethode'',
mais qu'il dit plut\^ot ``envoyer un message''.
Cette formule refl\`ete l'id\'ee que les objets sont responsables de
leurs propres actions. Vous ne pourrez jamais \emph{dire} \`a un objet
ce qu'il doit faire\,---\,vous devrez lui \emph{demander} de mani\`ere
courtoise de faire quelque chose en lui envoyant un message.
C'est l'objet, et non vous, qui choisissez la m\'ethode appropri\'ee
pour r\'epondre \`a votre message.

%=================================================================
\section{Les raccourcis-clavier}

Si vous voulez \'evaluer une expression, vous n'avez pas besoin de
toujours passer par le menu accessible via le bouton jaune: les
\ind{raccourcis-clavier} sont l\`a pour vous. Ils sont mentionn\'es
dans les expressions parenth\'es\'ees des options des menus. Selon
votre plateforme, vous pouvez \^etre amen\'e \`a presser l'une des
touches de modifications soit \texttt{Control}, \texttt{Alt},
\texttt{Command} ou \texttt{Meta} (nous les indiquerons de mani\`ere
g\'en\'erique par \short{\emph{touche}}).

\dothis{R\'e\'evaluez l'expression dans le Workspace en utilisant
  cette fois-ci le raccourci-clavier: \short{d}.}
\index{raccourci-clavier!do it}

En plus de \menu{do it}, vous aurez not\'e la pr\'esence de
\menu{print it} 
%ajout
(pour \'evaluer et afficher le r\'esultat dans le m\^eme espace de travail), 
de \menu{inspect it} (pour inspecter) et de \menu{explore it} (pour
explorer). 
Jetons un \oe il \`a ceux-ci.

\dothis{Entrez l'expression \ct{3 + 4} dans le Workspace. Maintenant
  \'evaluez en faisant un \menu{do it} avec le raccourci-clavier.}

Ne soyez pas surpris si vous voyez que rien ne se passe!
Ce qui vous venez de faire, c'est d'envoyer le message \ct{+} avec
l'argument \ct{4} au nombre \ct{3}. Le r\'esultat \ct{7} aura
normalement \'et\'e calcul\'e et retourn\'e, mais puisque votre espace de
travail Workspace ne savait que faire de ce r\'esultat, la r\'eponse a
simplement \'et\'e jet\'ee dans le vide. Si vous voulez voir le
r\'esultat, vous devriez faire \menu{print it} au lieu
de \menu{do it}. En fait, \menu{print it} compile l'expression,
l'ex\'ecute et envoie le message \ct{printString} au r\'esultat puis
affiche la cha\^{\i}ne de caract\`ere r\'esultante.

\dothis{S\'electionnez \ct{3+4} et faites \menu{print it} (\short{p}).}
Cette fois, nous pouvons lire le r\'esultat que nous attendions (voir
\figref{printit}).
\index{raccourci-clavier!print it}

\begin{figure}[htb]
% \centerline {\includegraphics[width=0.4\textwidth]{PrintIt}}
\centerline {\includegraphics[scale=0.7]{PrintIt}}
\caption{Afficher le r\'esultat sous forme de cha\^{\i}ne de
  caract\`eres avec \menu{print it} plut\^ot que de simplement
  \'evaluer avec \menu{do it}. \label{fig:printit}}
\end{figure}

\needlines{3}
\begin{code}{@TEST}
3 + 4 --> 7
\end{code}
\noindent
Nous utilisons la notation \ct{-->} comme convention dans tout le
livre pour indiquer qu'une expression particuli\`ere donne un certain
r\'esultat quand vous l'\'evaluez avec \menu{print it}.

\dothis{Effacez le texte surlign\'e ``\ct{7}''; comme \sq devrait l'avoir
  s\'electionn\'e pour vous, vous n'avez qu'\`a presser sur la touche
  de suppression (suivant votre type de clavier \texttt{Suppr.} ou
  \texttt{Del.}). S\'electionnez \ct{3+4} \`a nouveau et, cette fois,
  faites une inspection avec \menu{inspect it} (\short{i}).}
%ajout
\index{raccourci-clavier!inspect it}
\index{inspecteur}
\seeindex{Inspector}{inspecteur}

\noindent
Vous devriez maintenant voir une nouvelle fen\^etre appel\'ee
\emphind{inspecteur} avec pour titre 
 \ct{SmallInteger: 7} (voir \figref{inspectit}).
L'inspecteur ou (sous son nom de classe) Inspector est un outil
extr\^emement utile: il vous permet de naviguer et d'interagir avec
n'importe quel objet du syst\`eme.
Le titre nous dit que \ct{7} est une instance de la classe
\clsind{SmallInteger} 
%ajout
(classe des entiers sur 31 bits).
Le panneau de gauche nous offre une vue des variables d'instance de
l'objet en cours d'inspection. Nous pouvons naviguer entre ces
variables et le panneau de droite nous affiche leur valeur.
Le panneau inf\'erieur peut \^etre utilis\'e pour \'ecrire des
expressions envoyant des messages \`a l'objet.

\begin{figure}[htb]
\centerline {\includegraphics[scale=0.7]{InspectIt}}
\caption{Inspecter un objet.\label{fig:inspectit}}
\end{figure}

\dothis{Saisissez \ct{self squared} dans le panneau inf\'erieur de
  l'inspecteur que vous aviez ouvert sur l'entier \ct{7} et faites un
  \menu{print it}.
%ajout
Le message \ct{squared} (carr\'e) va \'elever le nombre \ct{7} lui-m\^eme (\ct{self}).}

\needlines{2}
\dothis{Fermez l'inspecteur. Saisissez dans un Workspace le
  mot-expression \ct{Object} et explorez-le via \menu{explore it}
  (\short{I}, i majuscule).}
\index{raccourci-clavier!explore it}
\index{explorateur}
\seeindex{Explorer}{explorateur}

Vous devriez voir maintenant une fen\^etre intitul\'ee \clsind{Object}
contenant le texte \mbox{$\triangleright$ \ct{root: Object}}.
Cliquez sur le triangle pour l'ouvrir (voir \figref{exploreit}).

\begin{figure}[htb]
\centerline {\includegraphics[scale=0.7]{ExploreIt}}
\caption{Explorer un objet.\label{fig:exploreit}}
\end{figure}

Cette explorateur (ou Explorer) est similaire \`a l'inspecteur mais il
offre une vue arborescente d'un objet complexe.
Dans notre cas, l'objet que nous observons est la classe \ct{Object}.
Nous pouvons voir directement toutes les informations stock\'ees dans
cette classe et naviguer facilement dans toutes ses parties.

%=================================================================
\section{\sqmap}
\index{SqueakMap}

%web-based catalogue
\sqmap est un catalogue web des ``\ind{package}{}s'' ou
paquetages\,---\,applications et biblioth\`eques de programmes (dites
aussi librairies)\,---\,que vous pouvez t\'el\'echarger dans votre
image.
Les \ind{paquetage}{}s sont h\'eberg\'es sur de nombreux serveurs de
par le monde et sont maintenus par un grand nombre de personnes, dont
certaines ne peuvent travailler seulement que sur une version
sp\'ecifique de \sq.
\lr{Maybe mention Package Universes (SqueakMap is not maintained anymore)}

\dothis{Ouvrez \menu{World \go open\ldots \go \sqmap Package Loader}.}
Vous aurez besoin d'une connection Internet pour que cela
fonctionne. Au bout d'un certain temps, la fen\^etre du gestionnaire
de chargement \sqmap devrait appara\^{\i}tre (voir \figref{sokoban}).
Sur le c\^ot\'e gauche, vous pouvez voir une longue liste de
paquetages. Le champ de saisie situ\'e dans le coin sup\'erieur gauche
est un panneau de recherche pour vous aider \`a trouver ce que vous
cherchez dans la liste.

Saisissez ``\ind{Sokoban}'' dans ce champ de recherche et
  tapez sur la touche entr\'ee.
Cliquer sur le triangle dirig\'e vers le nom du paquetage vous
r\'ev\`ele une liste des versions disponibles. Quand un paquetage ou
une version est s\'electionn\'e, des informations \`a leur sujet sont
affich\'ees dans le panneau de droite.
Naviguez dans la derni\`ere version du jeu \ct{Sokoban}.
Activez le menu contextuel du panneau de liste en cliquant dans cet
espace avec le \ind{bouton jaune} et choisissez \menu{install} pour
installer le paquetage s\'electionn\'e
(si \sq se plaint qu'il n'est pas s\^ur que cette version du jeu
fonctionne dans votre image, r\'epondez aux questions par ``yes'' 
%ajout
pour confirmer l'installation).
Remarquez qu'une fois que le paquetage a \'et\'e install\'e, il est
marqu\'e d'une ast\'erisque dans la liste du \sqmap Package Loader.

\begin{figure}[htb]
\ifluluelse
	{\centerline {\includegraphics[width=\textwidth]{SqueakMap}}}
	{\centerline {\includegraphics[scale=0.7]{SqueakMap}}}
\caption{Utiliser \sqmap pour installer le jeu Sokoban.\label{fig:sokoban}}
\end{figure}

\dothis{Apr\`es avoir installer ce paquetage, d\'emarrez \ct{Sokoban}
  en \'evaluant \ct{SokobanMorph random openInWorld} dans un Workspace
%ajout
(souvenez-vous de faire \menu{do it} sur toute la s\'election).}

% You can also try the \ct{NsGame}; execute it using \ct{NsGame new openInWorld}.
% ON: I could not find NsGame anywhere!

Le panneau inf\'erieur gauche du \sqmap Package Loader fournit
plusieurs possibilit\'es pour filtrer la liste des paquetages. Vous
pouvez choisir de ne voir que les paquetages qui sont compatibles avec
une version particuli\`ere de \sq
%ajout
(\emph{Squeak versions}), 
ou qui sont de la famille des jeux
%ajout
(\emph{Entertainment\go{}Games}), 
\etc.

%=================================================================
\section{Le System Browser}

Le navigateur de classes nomm\'e \ind{System Browser} est un des
outils-cl\'e pour programmation.
Comme nous le verrons bient\^ot, il y a plusieurs navigateurs ou
\emph{browsers} int\'eressants disponibles pour \sq, mais c'est le
plus simple que vous pourrez trouver dans n'importe quelle image.
\seeindex{navigateur de classe}{System Browser}
\seeindex{Class Browser}{System Browser}
\seeindex{browser}{System Browser}

\dothis{Ouvrir un navigateur de classes en s\'electionnant \menu{World
    \go{} open\ldots \go Class Browser} ou en faisant un
  gliss\'e-d\'epos\'e de l'ic\^one Browser depuis \toolsflapind.}

\begin{figure}[htb]
\ifluluelse
	{\centerline {\includegraphics[width=\textwidth]{ClassBrowser1}}}
	{\centerline {\includegraphics[scale=0.7]{ClassBrowser1}}}
\caption{Le navigateur de classes System Browser affichant la
  m\'ethode \ct{printString} de la classe Object.
\label{fig:classBrowser}}
\end{figure}

Nous pouvons voir un navigateur de classes sur \figref{classBrowser}.
La barre de titre indique que nous sommes en train de parcourir la
classe \clsind{Object}.

\`A l'ouverture du Browser, tous les panneaux sont vides exc\'ept\'e
le premier \`a gauche.
Ce premier panneau liste toutes les \emph{cat\'egories-syst\`eme}
connues; elles groupent des classes connexes.
\index{cat\'egorie}

\dothis{Cliquez sur la cat\'egorie \scatind{Kernel-Objects}.}
Cette manipulation est responsable de l'affichage de toutes les
classes de la cat\'egorie s\'electionn\'ee dans la seconde colonne.

\dothis{S\'electionnez la classe \clsind{Object}.}
D\'esormais les deux panneaux restants se remplissent.
Le troisi\`eme panneau affiche les \emph{protocoles} de la classe
s\'electionn\'ee.
Ce sont des regroupements commodes pour relier des m\'ethodes
connexes. Si aucun \ind{protocole} n'est s\'electionn\'e, vous devriez
voir toutes les m\'ethodes disponibles de la classe dans le
quatri\`eme panneau.

\dothis{S\'electionnez le protocole \protind{printing}, 
%ajout
protocole de l'affichage.}
Vous pourriez avoir besoin de faire d\'efiler (avec la barre de
d\'efilement) la liste des protocoles pour le trouver.
Vous ne verrez maintenant que les m\'ethodes relatives \`a
l'affichage.

\dothis{S\'electionnez la m\'ethode \mthind{Object}{printString}.}
D\`es lors, vous verrez dans la partie inf\'erieure du System Browser
le code source de la m\'ethode \ct{printString} partag\'ee par tous
les objets 
%ajout
(tous h\'eritiers de la classe Object)
(exception faite de ceux qui la surcharge).

%=================================================================
\section{Trouver les classes}

There are several ways to find a class in \sq.  The first, as we have just seen above, is to know (or guess) what category it is in, and to navigate to it using the browser.
\index{System Browser}
\seeindex{system browser!finding classes}{class, finding}
\index{classe!recherche}
\seeindex{classe!trouver}{classe, recherche}

A second way is to send the \ct{browse} message to the class, asking it to open a browser on itself.  Suppose we want to browse the class \clsind{Boolean}.

\dothis{Type \ct{Boolean browse} into a workspace and \menu{do it}.}
A browser will open on the Boolean class (\figref{browseBoolean}).
There is also a \ind{keyboard shortcut} \short{b} (browse) that you can use in any tool where you find a class name;
\index{raccourci-clavier!browse it}
select the name and type \short{b}.

\dothis{Use the keyboard shortcut to browse the class \ct{Boolean}.}

\begin{figure}[hbt]
\ifluluelse
	{\centerline {\includegraphics[width=\textwidth]{Kernel-objects-boolean}}}
	{\centerline {\includegraphics[scale=0.7]{Kernel-objects-boolean}}}
\caption{The system browser showing the definition of class Boolean.
\label{fig:browseBoolean}}
\end{figure}

Notice that when the \ct{Boolean} class is selected but no protocol or method is selected, two panes rather than one appear below the four panes at the top
(\figref{browseBoolean}).
The upper one contains the \emph{class definition}.
This is nothing more than an ordinary \st message that is sent to the parent class, asking it to create a subclass.
Here we see that the class \ct{Object} is being asked to create a subclass named \ct{Boolean} with no instance variables, class variables or ``pool dictionaries'', and to put the class \ct{Boolean} in the \scatind{Kernel-Objects} category.

The lower pane shows the \emph{class comment} --- a piece of plain text describing the class.
If you click on the \button{?} at the bottom of the class pane, you can see the class \subind{class}{comment} in a dedicated pane.

\ab{I thought that this was supposed to be a \emph{Quick} tour!  And here we are describing a tool that I have used maybe twice in 10 years!   In any case, this description should be deferred to the \textbf{Environment} chapter}
\on{I don't see why.  I use the hierarchy browser a lot!  I think it is really useful to know from the beginning, to help you find your through the hierarchy.}
If you would like to explore \sq's inheritance hierarchy, the \emphind{hierarchy browser} can help you.  
This can be useful if you are looking for an unknown subclass or superclass of a known class.
The hierarchy browser is like the system browser, except that the list of classes is arranged as an indented tree mirroring the inheritance hierarchy.

\dothis{Click on \button{hierarchy} in the browser while the class \ct{Boolean} is selected.}
\noindent
This will open a hierarchy browser showing the superclasses and subclasses of \clsind{Boolean}.
% (\figref{booleanhierarchybrowser}).
Navigate to the immediate superclass and subclasses of \ct{Boolean}.

Often, the fastest way to find a class is to search for it by name.  For example, suppose that you are looking for some unknown class that represents dates and times.

\dothis{Put the mouse in the system category pane of the system browser and type \short{f}, or select \menu{find class \ldots (f)} from the yellow-button menu.  Type ``time'' in the dialog box and accept it.} 
\noindent
You will be presented with a list of classes whose names contain ``time'' (see \figref{findit}).  Choose one, say, \ct{Time}, and the browser will show it, along with a class comment that suggests other classes that might be useful.  If you want to browse one of the others, select its name (in any text pane), and type \short{b}.
\index{raccourci-clavier!find\ldots}
\index{raccourci-clavier!browse it}

\begin{figure}[hbt]
\centerline{
\ifluluelse{
	\includegraphics[width=0.5\textwidth]{FindIt}
	\hspace{1cm}
	\includegraphics[width=0.4\textwidth]{TimeClasses}
}{
	\includegraphics[width=0.4\textwidth]{FindIt}
	\hspace{1cm}
	\includegraphics[width=0.3\textwidth]{TimeClasses}
}
}
\caption{Searching for a class by name.
\label{fig:findit}}
\end{figure}

Note that if you type the complete (and correctly capitalized) name of a class in the find dialog, the browser will go directly to that class without showing you the list of options.

%=================================================================
\section{Trouver les m\'ethodes}
\label{sec:quick:methodFinder}

Sometimes you can guess the name of a method, or at least part of the name of a method, more easily than the name of a class.  For example, if you are interested in the current time, you might expect that there would be a method called ``now'', or containing ``now'' as a substring.   But where might it be?
The \emphind{method finder} can help you.
\seeindex{system browser!finding methods}{method, finding}
\index{m\'ethode!recherche}
\seeindex{m\'ethode!trouver}{m\'ethode, recherche}

\dothis{Drag the \menu{method finder} icon out of the  \toolsflapind.
Type ``now'' in the top left pane, and \menu{accept} it (or just press the \textsc{return} key).}
The method finder will display a list of all the method names that contain the substring ``now''.  
To scroll to \ct{now} itself, type ``\ct{n}''; this trick works in all scrolling windows.  Select ``now'' and the right-hand pane shows you the three classes that define a method with this name, as shown in \figref{MethodFinder}.  Selecting any one of them will open a browser on it.

\begin{figure}[hbt]
\centerline {\includegraphics[scale=0.7]{methodFinder-now}}
\caption{The method finder showing three classes that define a method named \ct{now}.
\label{fig:MethodFinder}}
\end{figure}

At other times you may have a good idea that a method exists, but will have no idea what it might be called.
The method finder can still help!  For example, suppose that you would like to find a method that turns a string into upper case, for example, it would translate \ct{'eureka'} into \ct{'EUREKA'}.

\dothis{Type \ct{'eureka' . 'EUREKA'} into the method finder, as shown in \figref{methodFinder-example1}.}
\noindent
The method finder will suggest a method that does what you want.

An asterisk at the beginning of a line in the right pane of the method finder indicates that this method is the one that was actually used to obtain the requested result. 
So, the asterisk in front of \ct{String asUppercase} lets us know that the method \mthind{String}{asUppercase} defined on the class \clsind{String} was executed and returned the result we wanted. The methods that do not have an asterisk are just the other methods that have the same name as the ones that returned the expected result. So \cmind{Character}{asUppercase} was not executed on our example, because \ct{'eureka'} is not a \clsind{Character} object.

\begin{figure}[hbt]
\ifluluelse
	{\centerline {\includegraphics[width=0.9\textwidth]{MethodFinder-example1}}}
	{\centerline {\includegraphics[scale=0.7]{MethodFinder-example1}}}
\caption{Finding a method by example.
\label{fig:methodFinder-example1}}
\end{figure}

You can also use the method finder for methods with arguments; for example, if you are looking for a method that will find the greatest common factor of two integers, you might try \ct{25. 35. 5} as an example.  You can also give the method finder multiple examples to narrow the search space; the help text in the bottom pane explains more.

%=================================================================
\section{D\'efinir une nouvelle m\'ethode}

The advent of \ind{Test Driven Development}\cite{Beck03a} has changed the way that we write code.  
The idea behind Test Driven Development, also called TDD or Behaviour Driven Development, is that we write a test that defines the desired behaviour of our code \emph{before} we write the code itself.
Only then do we write the code that satisfies the test.
\seeindex{Behavior Driven Development}{Test Driven Development}
\orla{describe the technique where we write a test hat ... subsequently we write ...}

Suppose that our assignment is to write a method that ``says something loudly and with emphasis''.  What exactly could that mean?  What would be a good name for such a method?  How can we make sure  that programmers who may have to maintain our method in the future have an unambiguous description of what it should do?   We can answer all of these questions by giving an example:

\begin{quote}
When we send the message \ct{shout} to the string ``Don't panic'' the result should be ``DON'T PANIC!''.
\end{quote}

\noindent
To make this example into something that the system can use, we turn it into a test method:
\index{testing}
\index{SUnit}

\needlines{3}
\begin{method}[testShout]{A test for a shout method}
testShout
	self assert: ('Don''t panic' shout = 'DON''T PANICBANG')
\end{method} % BANG is the escape for !

How do we create a new method in \sq?   First, we have to decide which class the method should belong to.
In this case, the \ct{shout} method that we are testing will go in class \clsind{String}, so the corresponding test will, by convention, go in a class called \clsind{StringTest}.

\begin{figure}[hbt]
\ifluluelse
	{\centerline {\includegraphics[width=\textwidth]{StringTest-newMethodTemplate}}}
	{\centerline {\includegraphics[width=0.7\textwidth]{StringTest-newMethodTemplate}}}
\caption{The new method template in class \ct{StringTest}.
\label{fig:newMethodTemplate}}
\end{figure}

\dothis{Open a browser on the class \ct{StringTest}, and select an appropriate protocol for our method, in this case \menu{tests - converting}, as shown in \figref{newMethodTemplate}.
The highlighted text in the bottom pane is a template that reminds you what a \st method looks like.
Delete this and enter the code from  \mthref{testShout}.}
Once you have typed the text into the browser, notice that the bottom pane is outlined in red.  This is a reminder that the pane contains unsaved changes.
So select \menu{accept (s)} from the yellow-button menu in the bottom pane, or just type \short{s}, to compile and save your method.
\index{raccourci-clavier}
\index{raccourci-clavier!accept}
\seeindex{accept it}{raccourci-clavier, accept}
%ajout
\seeindex{m\'ethode!accepter}{raccourci-clavier, accept}

Because there is as yet no method called \ct{shout}, the browser will ask you to confirm that this is the name that you really want\,---\,and it will suggest some other names that you might have intended (\figref{testShoutConfirm}).
This can be quite useful if you have merely made a typing mistake, but in this case, we really \emph{do} mean \ct{shout}, since that is the method we are about to create, so we have to confirm this by selecting the first option from the menu of choices, as shown in \figref{testShoutConfirm}. 

\begin{figure}[hbt]
\ifluluelse
	{\centerline {\includegraphics[width=\textwidth]{testShoutConfirm}}}
	{\centerline {\includegraphics[scale=0.7]{testShoutConfirm}}}
\caption{Accepting the testShout method class \ct{StringTest}.
\label{fig:testShoutConfirm}}
\end{figure}

\dothis{Run your newly created test: open the \ind{SUnit} \emphind{TestRunner}, either by dragging it from the \toolsflapind, or by selecting \menu{World \go open... \go Test Runner}.}

The leftmost two panes are a bit like the top panes in the system browser.  The left pane contains a list of system categories, but it's restricted to those categories that contain test classes.

\dothis{Select \scat{CollectionsTests-Text} and the pane to the right will show all of the test classes in that category, which includes the class \ct{StringTest}.  The names of the classes are already selected, so click \menu{Run Selected} to run all these tests.}

\begin{figure}[hbt]
\ifluluelse
	{\centerline {\includegraphics[width=\textwidth]{testRunnerOnStringTest}}}
	{\centerline {\includegraphics[scale=0.5]{testRunnerOnStringTest}}}
\caption{Running the String tests.
\label{fig:testRunnerTestShout}}
\end{figure}

You should see a message like that shown in \figref{testRunnerTestShout}, which indicates that there was an error in running the tests.  The list of tests that gave rise to errors is shown in the bottom right pane; as you can see, \ct{StringTest>>>#testShout} is the culprit.
(Note that \ct{StringTest>>#testShout} is the Smalltalk way of identifying the \mthind{StringTest}{testShout} method of the \ct{StringTest} class.)
If you click on that line of text, the erroneous test will run again, this time in such a way that you see the error happen: ``\ct{MessageNotUnderstood: ByteString>>>shout}''.
\seeindex{\ct{>>}}{Behavior, \ct{>>}}
\cmindex{Behavior}{>>}

The window that opens with the error message is the \st debugger (see \figref{predebugger}).
\ab{Well, it's actually the \emph{pre-}debugger.  Does this matter?}\damien{I don't think it's important at this point.}
We will look at the \ind{debugger} and how to use it in \charef{env}.

\begin{figure}[hbt]
\ifluluelse
	{\centerline {\includegraphics[width=\textwidth]{Predebugger}}}
	{\centerline {\includegraphics[scale=0.7]{Predebugger}}}
\caption{The (pre-)debugger.}
\label{fig:predebugger}
\end{figure}

The error is, of course, exactly what we expected:  running the test generates an error because we haven't yet written a method that tells strings how to \ct{shout}.  
Nevertheless, it's good practice to make sure that the test fails because this confirms that we have set up the testing machinery correctly and that the new test is actually being run.
Once you have seen the error, you can \button{Abandon} the running test, which will close the debugger window.
Note that often with Smalltalk you can define the missing method using the \button{Create} button, edit the newly-created method in the debugger, and then \button{Proceed} with the test.

Now let's define the method that will make the test succeed!

\dothis{Select class \clsind{String} in the system browser, select the \menu{converting} protocol, type the text in \mthref{shout} over the method creation template, and \menu{accept} it.
(Note: to get a \mbox{\ct{^}}, type \caret). }
\begin{method}[shout]{The shout method}
shout
	^ self asUppercase, 'BANG'
\end{method}

The comma is the string concatenation operation, so the body of this method appends an exclamation mark to an upper-case version of whatever \ct{String} object the \ct{shout} message was sent to.
The $\uparrow$ tells \sq that the expression that follows is the answer to be returned from the method, in this case the new concatenated string.
\seeindex{comma}{Collection, comma operator}
\index{Collection!op\'erateur virgule}

Does this method work?  Let's run the tests and see.

\dothis{Click on \menu{Run Selected} again in the test runner, and this time you should see a green bar and text indicating that all of the tests ran with no failures and no errors.}
When you get to a green bar\footnotemark, it's a good idea to save your work and take a break.  
So do that right now!
\footnotetext{Actually, you might not get a green bar since some images contains tests for bugs that need to be fixed.
Don't worry about this.
\Squeak is constantly evolving.
%:PROBLEM --- StringTest has a broken test!
% ON: There is a broken test in \ct{StringTest>>>\#testIndexOf}!
}

\begin{figure}[hbt]
\ifluluelse
	{\centerline{\includegraphics[width=\textwidth]{String-Shout}}}
	{\centerline{\includegraphics[scale=0.7]{String-Shout}}}
\caption{The \ct{shout} method defined on class \ct{String}.
\label{fig:String-shout}}
\end{figure}

%=================================================================
\section{R\'esum\'e du chapitre}
%martial: j'ai mis 'intronise' si trop solennel, corriger par 'presente'
Dans ce chapitre, nous vous avons intronis\'e \`a l'environnement de
\sq et nous vous avons montr\'e comment utiliser certains des
principaux outils comme le  System Browser, le
Method Finder et le Test Runner. Vous avez pu voir un aper\c{c}u de la
syntaxe sans que vous puissiez encore la comprendre suffisamment \`a ce stade.

\begin{itemize}
  \item Un syst\`me \sq fonctionnel comprend une \emph{machine
      virtuelle} (souvent abr\'eg\'ee par VM), une fichier
    \emph{sources} et un couple de fichiers: une \emph{image} et un
    fichier \emph{changes}. Ces deux derniers sont les seuls \`a
    \^etre susceptible de changer, puisqu'ils sauvegardent un clich\'e
    du syst\`eme actif.
  \item Quand vous restorez une image \sq, vous vous retrouvez
    exactement dans le m\^eme \'etat\,---\,avec les m\^eme objets
    lanc\'es\,---\,que vous l'aviez laiss\'e lors de votre derni\`ere
    sauvegarde de cette image.
  \item \sq est destin\'e \`a fonctionner avec une souris \`a trois
    boutons. Par convention, nous disons qu'il y a un bouton \emph{rouge}, un bouton
    \emph{jaune} et un bouton \emph{bleu}. Si vous n'avez pas de
    souris \`a trois boutons, vous pouvez utiliser des touches de
    modifications au clavier pour obtenir le m\^eme effet.
  \item Vous utilisez le \ind{bouton rouge} sur l'arri\`ere-plan de
    \sq pour faire appara\^{\i}tre le \emph{menu World} et pouvoir
    lancer depuis celui-ci divers outils. Vous pouvez aussi trouver
    les outils principaux dans \toolsflapind situ\'e \`a droite de
    l'\'ecran \sq.
  \item Un \emph{Workspace} ou espace de travail est un outil
    destin\'e \`a \'ecrire et \'evaluer des fragments de code. Vous
    pouvez aussi l'utiliser pour y stocker un texte quelconque.
  \item Vous pouvez utiliser des \ind{raccourcis-clavier} sur du texte
    dans un Workspace ou tout autre outil pour en
    \'evaluer le code. Les plus importants sont \menu{do it} (\short{d}), \menu{print it} (\short{p}), \menu{inspect it} (\short{i}) et \menu{explore it} (\short{I}).
  \item \sqmap est un outil pour t\'el\'echarger des paquetages utiles
    depuis Internet.
  \item Le navigateur de classes \emph{System Browser} est le
    principal outil pour naviguer dans le code \sq et pour
    d\'evelopper du nouveau code.
  \item Le \emph{Test Runner} permet d'effectuer des tests
    unitaires. Il supporte pleinement la m\'ethodologie de
    programmation orient\'ee test connus sous le nom de \emph{Test
      Driven Development}.
\end{itemize}

%=================================================================
\ifx\wholebook\relax\else 
   \bibliographystyle{jurabib}
   \nobibliography{scg}
   \end{document}
\fi
%=================================================================

%%% Local Variables:
%%% coding: utf-8
%%% mode: latex
%%% TeX-master: t
%%% TeX-PDF-mode: t
%%% ispell-local-dictionary: "english"
%%% End:
